{
  "rules": {
    // Curriculum - read by all authenticated users
    "curriculum": {
      ".read": "auth != null",
      ".write": "root.child('user-roles/admins').val().contains(auth.token.email) || root.child('user-roles/teachers').val().contains(auth.token.email)"
    },

    // Quizzes - read by all, write by admin/teachers
    "quizzes": {
      ".read": "auth != null",
      ".write": "root.child('user-roles/admins').val().contains(auth.token.email) || root.child('user-roles/teachers').val().contains(auth.token.email)"
    },

    // Quiz results - users can write their own, all authenticated can read
    "quiz-results": {
      ".read": "auth != null",
      "$resultId": {
        ".write": "auth != null && (!data.exists() || data.child('userId').val() == auth.uid)"
      }
    },

    // User profiles - users can read/write their own, admins/teachers can read all
    "users": {
      "$userId": {
        ".read": "auth != null && (auth.uid == $userId || root.child('user-roles/admins').val().contains(auth.token.email) || root.child('user-roles/teachers').val().contains(auth.token.email))",
        ".write": "auth != null && auth.uid == $userId"
      }
    },

    // Assignments - admins/teachers can write, assigned users can read
    "assignments": {
      "$userId": {
        ".read": "auth != null && (auth.uid == $userId || root.child('user-roles/admins').val().contains(auth.token.email) || root.child('user-roles/teachers').val().contains(auth.token.email))",
        ".write": "root.child('user-roles/admins').val().contains(auth.token.email) || root.child('user-roles/teachers').val().contains(auth.token.email)"
      }
    },

    // Reading assignments - admins/teachers can write, students can only read/update their own status
    "reading-assignments": {
      "$userId": {
        ".read": "auth != null && (auth.uid == $userId || root.child('user-roles/admins').val().contains(auth.token.email) || root.child('user-roles/teachers').val().contains(auth.token.email))",
        "$bookId": {
          // Allow teachers/admins to write entire book record
          ".write": "root.child('user-roles/admins').val().contains(auth.token.email) || root.child('user-roles/teachers').val().contains(auth.token.email)",
          // Allow students to only update status of their own books
          "status": {
            ".write": "auth != null && auth.uid == $userId"
          },
          "currentChapter": {
            ".write": "auth != null && auth.uid == $userId"
          }
        }
      }
    },

    // Books cache - read by all authenticated, write by admins/teachers
    "books-cache": {
      ".read": "auth != null",
      ".write": "root.child('user-roles/admins').val().contains(auth.token.email) || root.child('user-roles/teachers').val().contains(auth.token.email)"
    },

    // Todos - users can manage their own, admins/teachers can read all
    "todos": {
      "$userId": {
        ".read": "auth != null && (auth.uid == $userId || root.child('user-roles/admins').val().contains(auth.token.email) || root.child('user-roles/teachers').val().contains(auth.token.email))",
        ".write": "auth != null && auth.uid == $userId"
      }
    },

    // User roles - read by all authenticated, write by admins only
    "user-roles": {
      ".read": "auth != null",
      ".write": "root.child('user-roles/admins').val().contains(auth.token.email)"
    },

    // AI usage logs - read/write by admins only
    "ai-usage-logs": {
      ".read": "root.child('user-roles/admins').val().contains(auth.token.email)",
      ".write": "root.child('user-roles/admins').val().contains(auth.token.email) || root.child('user-roles/teachers').val().contains(auth.token.email)"
    },

    // Config - API keys and settings (read by authenticated, write by admins only)
    "config": {
      ".read": "auth != null",
      ".write": "root.child('user-roles/admins').val().contains(auth.token.email)"
    }
  }
}
